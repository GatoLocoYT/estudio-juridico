<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin ¬∑ Estudio Jur√≠dico</title>

  <!-- Ajust√° la ruta al CSS generado por Tailwind -->
  <link rel="stylesheet" href="/assets/app.css" />

  <meta name="color-scheme" content="light" />
</head>

<body class="bg-slate-50 text-slate-900">
  <!-- Topbar -->
  <header class="sticky top-0 z-40 border-b border-slate-200 bg-white/85 backdrop-blur">
    <div class="mx-auto flex max-w-[1200px] items-center justify-between gap-3 px-4 py-3">
      <div class="flex items-center gap-3">
        <a href="/" class="flex items-center gap-2 rounded-lg px-2 py-1 hover:bg-slate-100">
          <div class="h-9 w-9 rounded-xl bg-slate-900 text-white grid place-items-center font-semibold">EJ</div>
          <div class="leading-tight">
            <div class="text-sm font-semibold">Panel de Administraci√≥n</div>
            <div class="text-xs text-slate-500">CRM ¬∑ Agenda ¬∑ Documentos</div>
          </div>
        </a>
      </div>

      <div class="flex items-center gap-2">
        <div class="hidden sm:flex items-center gap-2 rounded-xl border border-slate-200 bg-slate-50 px-3 py-2">
          <span class="inline-block h-2 w-2 rounded-full bg-emerald-500"></span>
          <span class="text-xs text-slate-600">Sesi√≥n activa</span>
          <span class="text-xs font-medium text-slate-900" id="adminEmail">admin@estudio.com</span>
        </div>

        <button
          id="btnLogout"
          class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium hover:bg-slate-100 active:scale-[0.99]"
        >
          Cerrar sesi√≥n
        </button>
      </div>
    </div>
  </header>

  <!-- Layout -->
  <main class="mx-auto grid max-w-[1200px] grid-cols-1 gap-4 px-4 py-4 lg:grid-cols-[280px_1fr]">
    <!-- Sidebar -->
    <aside class="rounded-2xl border border-slate-200 bg-white p-3">
      <div class="mb-3">
        <div class="text-xs font-semibold text-slate-500">NAVEGACI√ìN</div>
      </div>

      <nav class="space-y-1">
        <button data-view="dashboard" class="nav-btn w-full rounded-xl px-3 py-2 text-left text-sm font-medium hover:bg-slate-100 bg-slate-100">
          Dashboard
        </button>
        <button data-view="appointments" class="nav-btn w-full rounded-xl px-3 py-2 text-left text-sm font-medium hover:bg-slate-100">
          Agenda (Turnos)
        </button>
        <button data-view="clients" class="nav-btn w-full rounded-xl px-3 py-2 text-left text-sm font-medium hover:bg-slate-100">
          Clientes
        </button>
        <button data-view="cases" class="nav-btn w-full rounded-xl px-3 py-2 text-left text-sm font-medium hover:bg-slate-100">
          Casos
        </button>
        <button data-view="documents" class="nav-btn w-full rounded-xl px-3 py-2 text-left text-sm font-medium hover:bg-slate-100">
          Documentos
        </button>
        <button data-view="lawyers" class="nav-btn w-full rounded-xl px-3 py-2 text-left text-sm font-medium hover:bg-slate-100">
          Abogados
        </button>
      </nav>

      <div class="mt-4 rounded-2xl border border-slate-200 bg-slate-50 p-3">
        <div class="text-xs font-semibold text-slate-600">Estado del sistema</div>
        <div class="mt-2 space-y-2 text-xs text-slate-600">
          <div class="flex items-center justify-between">
            <span>API</span>
            <span class="font-medium" id="apiStatus">‚Äî</span>
          </div>
          <div class="flex items-center justify-between">
            <span>Base de datos</span>
            <span class="font-medium" id="dbStatus">‚Äî</span>
          </div>
          <div class="flex items-center justify-between">
            <span>√öltima actividad</span>
            <span class="font-medium" id="lastActivity">‚Äî</span>
          </div>
        </div>
        <button id="btnHealth" class="mt-3 w-full rounded-xl bg-slate-900 px-3 py-2 text-sm font-medium text-white hover:bg-slate-800 active:scale-[0.99]">
          Probar conexi√≥n
        </button>
      </div>
    </aside>

    <!-- Content -->
    <section class="space-y-4">
      <!-- Page header -->
      <div class="rounded-2xl border border-slate-200 bg-white p-4">
        <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
          <div>
            <h1 class="text-lg font-semibold" id="viewTitle">Dashboard</h1>
            <p class="text-sm text-slate-600" id="viewSubtitle">Resumen general del estudio</p>
          </div>

          <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
            <div class="relative">
              <input
                id="searchInput"
                type="text"
                placeholder="Buscar (nombre, email, tel√©fono, t√≠tulo, etc.)"
                class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 pr-10 text-sm outline-none ring-slate-200 focus:ring-2 sm:w-[360px]"
              />
              <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-slate-400">‚åï</span>
            </div>

            <select title="Filtro"
              id="filterSelect"
              class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm outline-none ring-slate-200 focus:ring-2"
            >
              <option value="">Filtro r√°pido</option>
              <option value="status:active">Status: active</option>
              <option value="status:inactive">Status: inactive</option>
              <option value="priority:high">Priority: high</option>
              <option value="priority:medium">Priority: medium</option>
              <option value="priority:low">Priority: low</option>
            </select>

            <button
              id="btnNew"
              class="rounded-xl bg-emerald-600 px-3 py-2 text-sm font-medium text-white hover:bg-emerald-500 active:scale-[0.99]"
            >
              + Nuevo
            </button>
          </div>
        </div>

        <!-- KPI row -->
        <div class="mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4" id="kpis">
          <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3">
            <div class="text-xs font-semibold text-slate-500">Clientes</div>
            <div class="mt-1 text-2xl font-semibold" id="kpiClients">‚Äî</div>
            <div class="mt-1 text-xs text-slate-600">Activos</div>
          </div>
          <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3">
            <div class="text-xs font-semibold text-slate-500">Casos</div>
            <div class="mt-1 text-2xl font-semibold" id="kpiCases">‚Äî</div>
            <div class="mt-1 text-xs text-slate-600">En curso</div>
          </div>
          <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3">
            <div class="text-xs font-semibold text-slate-500">Turnos</div>
            <div class="mt-1 text-2xl font-semibold" id="kpiAppointments">‚Äî</div>
            <div class="mt-1 text-xs text-slate-600">Pr√≥ximos 7 d√≠as</div>
          </div>
          <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3">
            <div class="text-xs font-semibold text-slate-500">Documentos</div>
            <div class="mt-1 text-2xl font-semibold" id="kpiDocuments">‚Äî</div>
            <div class="mt-1 text-xs text-slate-600">Total</div>
          </div>
        </div>
      </div>

      <!-- Main card -->
      <div class="rounded-2xl border border-slate-200 bg-white p-4">
        <!-- Toolbar for tables -->
        <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
          <div class="flex items-center gap-2">
            <div class="text-sm font-semibold" id="tableTitle">Actividad reciente</div>
            <span class="rounded-full bg-slate-100 px-2 py-1 text-xs text-slate-600" id="tableCount">‚Äî</span>
          </div>

          <div class="flex flex-wrap items-center gap-2">
            <select title="Orden" id="sortSelect" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm outline-none ring-slate-200 focus:ring-2">
              <option value="created_at:desc">Orden: m√°s nuevo</option>
              <option value="created_at:asc">Orden: m√°s viejo</option>
              <option value="full_name:asc">Nombre A‚ÄìZ</option>
              <option value="full_name:desc">Nombre Z‚ÄìA</option>
              <option value="start_at:asc">Turno: m√°s cercano</option>
              <option value="start_at:desc">Turno: m√°s lejano</option>
            </select>

            <button id="btnRefresh" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium hover:bg-slate-100 active:scale-[0.99]">
              Actualizar
            </button>
          </div>
        </div>

        <!-- Loader -->
        <div id="loader" class="mt-4 hidden rounded-2xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600">
          Cargando‚Ä¶
        </div>

        <!-- Empty state -->
        <div id="emptyState" class="mt-4 hidden rounded-2xl border border-dashed border-slate-200 bg-white p-8 text-center">
          <div class="mx-auto grid h-12 w-12 place-items-center rounded-2xl bg-slate-100 text-slate-600">üìÑ</div>
          <div class="mt-3 text-sm font-semibold">Sin resultados</div>
          <div class="mt-1 text-sm text-slate-600">Prob√° con otro filtro o agreg√° un nuevo registro.</div>
          <button id="btnEmptyNew" class="mt-4 rounded-xl bg-emerald-600 px-3 py-2 text-sm font-medium text-white hover:bg-emerald-500">
            + Crear
          </button>
        </div>

        <!-- Table -->
        <div class="mt-4 overflow-auto rounded-2xl border border-slate-200">
          <table class="min-w-full text-left text-sm">
            <thead class="bg-slate-50 text-xs text-slate-600">
              <tr id="tableHead">
                <th class="px-4 py-3 font-semibold">Campo</th>
                <th class="px-4 py-3 font-semibold">Detalle</th>
                <th class="px-4 py-3 font-semibold">Estado</th>
                <th class="px-4 py-3 font-semibold">Actualizado</th>
                <th class="px-4 py-3 font-semibold text-right">Acciones</th>
              </tr>
            </thead>
            <tbody id="tableBody" class="divide-y divide-slate-200 bg-white">
              <!-- rows injected by JS -->
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="mt-4 flex items-center justify-between gap-2">
          <div class="text-xs text-slate-600" id="pageInfo">‚Äî</div>
          <div class="flex items-center gap-2">
            <button id="btnPrev" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium hover:bg-slate-100 disabled:opacity-50" disabled>
              ‚Üê Anterior
            </button>
            <button id="btnNext" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium hover:bg-slate-100 disabled:opacity-50" disabled>
              Siguiente ‚Üí
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="absolute inset-0 grid place-items-center p-4">
      <div class="w-full max-w-[720px] rounded-2xl border border-slate-200 bg-white shadow-xl">
        <div class="flex items-center justify-between border-b border-slate-200 px-4 py-3">
          <div>
            <div class="text-sm font-semibold" id="modalTitle">Nuevo</div>
            <div class="text-xs text-slate-600" id="modalSubtitle">Completar los campos</div>
          </div>
          <button id="btnModalClose" class="rounded-xl px-3 py-2 text-sm font-medium hover:bg-slate-100">Cerrar</button>
        </div>

        <form id="modalForm" class="p-4">
          <div id="modalFields" class="grid grid-cols-1 gap-3 sm:grid-cols-2">
            <!-- injected by JS -->
          </div>

          <div class="mt-4 flex flex-col-reverse gap-2 sm:flex-row sm:items-center sm:justify-between">
            <button id="btnModalDelete" type="button" class="hidden rounded-xl border border-rose-200 bg-white px-3 py-2 text-sm font-medium text-rose-600 hover:bg-rose-50">
              Eliminar
            </button>

            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end sm:gap-2">
              <button type="button" id="btnModalCancel" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium hover:bg-slate-100">
                Cancelar
              </button>
              <button type="submit" id="btnModalSave" class="rounded-xl bg-slate-900 px-3 py-2 text-sm font-medium text-white hover:bg-slate-800">
                Guardar
              </button>
            </div>
          </div>

          <div id="modalError" class="mt-3 hidden rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <div id="toasts" class="fixed bottom-4 right-4 z-[60] space-y-2"></div>

  <script>
    // === Mini UI helpers (sin acoplarse a tu l√≥gica de API) ===
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function setActiveNav(view) {
      $$(".nav-btn").forEach(btn => {
        btn.classList.toggle("bg-slate-100", btn.dataset.view === view);
      });
    }

    function toast(message, type = "info") {
      const wrap = $("#toasts");
      const el = document.createElement("div");
      const base = "rounded-xl border px-3 py-2 text-sm shadow bg-white";
      const color =
        type === "success" ? "border-emerald-200" :
        type === "error" ? "border-rose-200" :
        "border-slate-200";
      el.className = `${base} ${color}`;
      el.textContent = message;
      wrap.appendChild(el);
      setTimeout(() => el.remove(), 2600);
    }

    function showLoader(show) {
      $("#loader").classList.toggle("hidden", !show);
    }

    function showEmpty(show) {
      $("#emptyState").classList.toggle("hidden", !show);
    }

    function openModal({ title = "Nuevo", subtitle = "", fieldsHtml = "", showDelete = false } = {}) {
      $("#modalTitle").textContent = title;
      $("#modalSubtitle").textContent = subtitle;
      $("#modalFields").innerHTML = fieldsHtml;
      $("#modalError").classList.add("hidden");
      $("#btnModalDelete").classList.toggle("hidden", !showDelete);
      $("#modal").classList.remove("hidden");
    }

    function closeModal() {
      $("#modal").classList.add("hidden");
    }

    // events
    $("#btnModalClose").addEventListener("click", closeModal);
    $("#btnModalCancel").addEventListener("click", closeModal);
    $("#modal").addEventListener("click", (e) => {
      if (e.target === $("#modal").firstElementChild) closeModal();
    });

    $$(".nav-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const view = btn.dataset.view;
        setActiveNav(view);
        // Ac√° tu main.js deber√≠a escuchar cambios de view:
        window.dispatchEvent(new CustomEvent("admin:view", { detail: { view } }));
      });
    });

    $("#btnNew").addEventListener("click", () => {
      window.dispatchEvent(new CustomEvent("admin:new"));
    });

    $("#btnEmptyNew").addEventListener("click", () => {
      window.dispatchEvent(new CustomEvent("admin:new"));
    });

    $("#btnRefresh").addEventListener("click", () => {
      window.dispatchEvent(new CustomEvent("admin:refresh"));
    });

    $("#btnHealth").addEventListener("click", () => {
      window.dispatchEvent(new CustomEvent("admin:health"));
    });

    $("#searchInput").addEventListener("input", (e) => {
      window.dispatchEvent(new CustomEvent("admin:search", { detail: { q: e.target.value } }));
    });

    $("#filterSelect").addEventListener("change", (e) => {
      window.dispatchEvent(new CustomEvent("admin:filter", { detail: { filter: e.target.value } }));
    });

    $("#sortSelect").addEventListener("change", (e) => {
      window.dispatchEvent(new CustomEvent("admin:sort", { detail: { sort: e.target.value } }));
    });

    $("#btnPrev").addEventListener("click", () => {
      window.dispatchEvent(new CustomEvent("admin:page", { detail: { dir: -1 } }));
    });

    $("#btnNext").addEventListener("click", () => {
      window.dispatchEvent(new CustomEvent("admin:page", { detail: { dir: 1 } }));
    });

    $("#btnLogout").addEventListener("click", async () => {
      window.dispatchEvent(new CustomEvent("admin:logout"));
    });

    // Exponemos helpers para tu main.js
    window.AdminUI = {
      toast,
      showLoader,
      showEmpty,
      openModal,
      closeModal,
      setHeader(title, subtitle) {
        $("#viewTitle").textContent = title;
        $("#viewSubtitle").textContent = subtitle || "";
      },
      setKpis({ clients, cases, appointments, documents }) {
        if (clients != null) $("#kpiClients").textContent = String(clients);
        if (cases != null) $("#kpiCases").textContent = String(cases);
        if (appointments != null) $("#kpiAppointments").textContent = String(appointments);
        if (documents != null) $("#kpiDocuments").textContent = String(documents);
      },
      setSystemStatus({ api, db, last }) {
        if (api != null) $("#apiStatus").textContent = api;
        if (db != null) $("#dbStatus").textContent = db;
        if (last != null) $("#lastActivity").textContent = last;
      },
      setTable({ title, count, headHtml, bodyHtml, pageInfo, canPrev, canNext }) {
        if (title) $("#tableTitle").textContent = title;
        if (count != null) $("#tableCount").textContent = String(count);
        if (headHtml) $("#tableHead").innerHTML = headHtml;
        if (bodyHtml != null) $("#tableBody").innerHTML = bodyHtml;
        if (pageInfo != null) $("#pageInfo").textContent = pageInfo;
        $("#btnPrev").disabled = !canPrev;
        $("#btnNext").disabled = !canNext;
      },
      showLoader,
      showEmpty,
    };

    // Default view
    window.dispatchEvent(new CustomEvent("admin:view", { detail: { view: "dashboard" } }));
  </script>

  <!-- Tu l√≥gica real -->
  <script src="../js/main.js"></script>
</body>
</html>
